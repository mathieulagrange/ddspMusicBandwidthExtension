function checkOrientation(){var a=document.body.scrollWidth;$("#header").css("width",a.toString())}function callbackFilesLoaded(){if(pageManager.start(),pageTemplateRenderer.renderProgressBar("page_progressbar"),pageTemplateRenderer.renderHeader("page_header"),pageTemplateRenderer.renderNavigation("page_navigation"),0!=config.stopOnErrors&&errorHandler.errorOccurred()){var a=errorHandler.getErrors(),b=$("<ul style='text-align:left;'></ul>");$("#popupErrorsContent").append(b);for(var c=0;c<a.length;++c)b.append($("<li>"+a[c]+"</li>"));$("#popupErrors").popup("open"),$.mobile.loading("hide")}else $.mobile.loading("hide"),$("body").children().children().removeClass("ui-disabled");$.mobile.activePage&&$.mobile.activePage.trigger("create")}function callbackURLFound(){var a=errorHandler.getErrors(),b=$("<ul style='text-align:left;'></ul>");$("#popupErrorsContent").append(b);for(var c=0;c<a.length;++c)b.append($("<li>"+a[c]+"</li>"));$("#popupErrors").popup("open")}function addPagesToPageManager(a,b){for(var c=0;c<b.length;++c)if(Array.isArray(b[c]))"random"===b[c][0]&&(b[c].shift(),shuffle(b[c])),addPagesToPageManager(a,b[c]);else{var d=b[c];if("generic"==d.type)a.addPage(new GenericPage(a,d));else if("volume"==d.type){var e=new VolumePage(a,audioContext,audioFileLoader,d,config.bufferSize,errorHandler,config.language);a.addPage(e)}else if("mushra"==d.type){var f=new MushraPage(a,audioContext,config.bufferSize,audioFileLoader,session,d,mushraValidator,errorHandler,config.language);a.addPage(f)}else if("spatial"==d.type)a.addPage(new SpatialPage(a,d,session,audioContext,config.bufferSize,audioFileLoader,errorHandler,config.language));else if("paired_comparison"==d.type){var g=new PairedComparisonPageManager;g.createPages(a,pageTemplateRenderer,d,audioContext,config.bufferSize,audioFileLoader,session,errorHandler,config.language),g=null}else if("bs1116"==d.type){var h=new BS1116PageManager;h.createPages(a,pageTemplateRenderer,d,audioContext,config.bufferSize,audioFileLoader,session,errorHandler,config.language),h=null}else if("likert_single_stimulus"==d.type){var i=new LikertSingleStimulusPageManager;i.createPages(a,pageTemplateRenderer,d,audioContext,config.bufferSize,audioFileLoader,session,errorHandler,config.language),i=null}else if("likert_multi_stimulus"==d.type){var j=new LikertMultiStimulusPage(pageManager,pageTemplateRenderer,d,audioContext,config.bufferSize,audioFileLoader,session,errorHandler,config.language);a.addPage(j)}else if("finish"==d.type){var k=new FinishPage(a,session,dataSender,d,config.language);a.addPage(k)}else errorHandler.sendError("Type not specified.")}}function startup(a){null==a&&(errorHandler.sendError("URL couldn't be found!"),callbackURLFound()),$.mobile.page.prototype.options.theme="a";var b=setInterval(function(){$.mobile.loading("show",{text:"Loading...",textVisible:!0,theme:"a",html:""}),clearInterval(b)},1);null!==pageManager&&(pageTemplateRenderer.clear(),$("#page_content").empty(),$("#header").empty()),localizer=new Localizer,localizer.initializeNLSFragments(nls),pageManager=null,audioFileLoader=null,mushraValidator=null,dataSender=null,session=null,pageTemplateRenderer=null,interval2=null,document.title=a.testname,$("#header").append(document.createTextNode(a.testname)),pageManager=new PageManager("pageManager","page_content",localizer),window.AudioContext=window.AudioContext||window.webkitAudioContext,"undefined"!=typeof AudioContext?audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(audioContext=new webkitAudioContext),document.addEventListener("click",function(){"running"!==audioContext.state&&audioContext.resume()},!0);try{audioContext.destination.channelCountMode="explicit",audioContext.destination.channelInterpretation="discrete",audioContext.destination.channelCount=audioContext.destination.maxChannelCount}catch(a){console.log("webMUSHRA: Could not set channel count of destination node."),console.log(a)}audioContext.volume=1,audioFileLoader=new AudioFileLoader(audioContext,errorHandler),mushraValidator=new MushraValidator(errorHandler),dataSender=new DataSender(a),session=new Session,session.testId=a.testId,session.config=configFile,void 0==a.language&&(a.language="en"),pageTemplateRenderer=new PageTemplateRenderer(pageManager,a.showButtonPreviousPage,a.language),pageManager.addCallbackPageEventChanged(pageTemplateRenderer.refresh.bind(pageTemplateRenderer)),addPagesToPageManager(pageManager,a.pages),interval2=setInterval(function(){clearInterval(interval2),audioFileLoader.startLoading(callbackFilesLoaded)},10)}function getParameterByName(a){var b=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search);return b&&decodeURIComponent(b[1].replace(/\+/g," "))}window.onresize=function(a){pageManager.getCurrentPage()&&1==pageManager.getCurrentPage().isMushra&&pageManager.getCurrentPage().renderCanvas("mushra_items"),checkOrientation()};for(var i=0;i<$("body").children().length;i++)"popupErrors"!=$("body").children().eq(i).attr("id")&&"popupDialog"!=$("body").children().eq(i).attr("id")&&$("body").children().eq(i).addClass("ui-disabled");var config=null,configArg=getParameterByName("config"),configFile="";configFile=configArg?"configs/"+configArg:"configs/default.yaml";var errorHandler=new ErrorHandler,localizer=null,pageManager=null,audioContext=null,audioFileLoader=null,mushraValidator=null,dataSender=null,session=null,pageTemplateRenderer=null,interval2=null;YAML.load(configFile,function(a){config=a,startup(a)});